<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin for Blessing - Ayat Hari Ini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Lora:italic,wght@0,400;1,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 20px auto;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
            background: conic-gradient(
                #FF6B6B 0deg 36deg, 
                #4ECDC4 36deg 72deg, 
                #FFE66D 72deg 108deg, 
                #1A535C 108deg 144deg, 
                #FF9F1C 144deg 180deg, 
                #70C1B3 180deg 216deg,
                #A29BFE 216deg 252deg,
                #FAB1A0 252deg 288deg,
                #55E6C1 288deg 324deg,
                #FD79A8 324deg 360deg
            );
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: #f00;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
        }

        .center-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 65px;
            height: 65px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.8rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 15;
            user-select: none;
            color: #2D3436;
        }

        .center-button:active {
            transform: translate(-50%, -50%) scale(0.9);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 20px;
        }

        .verse-card {
            background: white;
            padding: 30px;
            border-radius: 24px;
            max-width: 450px;
            width: 100%;
            text-align: center;
            animation: popIn 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48);
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .verse-text {
            font-family: 'Lora', serif;
            font-style: italic;
            font-size: 1.25rem;
            color: #2D3436;
            line-height: 1.6;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #9333ea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-gray-50">

    <header class="text-center mt-10 mb-6 px-6">
        <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight">Daily Blessing</h1>
        <p class="text-gray-500 mt-2">Putar roda untuk menerima ayat kasih dan tantangan harimu!</p>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center w-full max-w-md px-4">
        <div class="wheel-container">
            <div class="pointer"></div>
            <div id="wheel"></div>
            <div class="center-button" id="spinBtn">PUTAR!</div>
        </div>
        
        <p id="status-text" class="mt-8 text-sm font-medium text-gray-400 animate-pulse text-center">
            Ketuk tombol PUTAR untuk memulai berkatmu
        </p>
    </main>

    <!-- Modal Result -->
    <div id="resultModal" class="modal">
        <div class="verse-card shadow-2xl border-t-8 border-pink-500 custom-scrollbar">
            <div class="text-pink-600 font-bold text-xs uppercase tracking-widest mb-3">Ayat Berkat Hari Ini</div>
            <p id="verseText" class="verse-text mb-2">"Tuhan adalah gembalaku, takkan kekurangan aku."</p>
            <p id="verseRef" class="font-bold text-gray-700 mb-6">Mazmur 23:1</p>
            
            <hr class="my-6 border-gray-100">
            
            <div class="text-orange-500 font-bold text-xs uppercase tracking-widest mb-2">Tantangan Kasih</div>
            <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 mb-6">
                <p id="challengeText" class="text-gray-700 font-medium italic text-sm">Berikan pujian tulus kepada 3 orang yang kamu temui hari ini.</p>
            </div>

            <!-- Gemini AI Section -->
            <div class="bg-purple-50 rounded-2xl p-4 text-left border border-purple-100 mb-6">
                <h4 class="text-purple-700 font-bold text-sm flex items-center mb-2">
                    <span class="mr-2">✨</span> Renungan & Doa AI
                </h4>
                <div id="aiResponse" class="text-sm text-gray-600 leading-relaxed min-h-[40px]">
                    <span class="text-gray-400 italic">Klik tombol di bawah untuk mendapatkan inspirasi mendalam...</span>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="aiBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg active:scale-95 flex items-center justify-center">
                    <span id="aiBtnText">Tanya Renungan AI</span>
                </button>
                <button onclick="closeModal()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-600 font-semibold py-3 px-6 rounded-xl transition-all">
                    Tutup & Simpan di Hati
                </button>
            </div>
        </div>
    </div>

    <footer class="mt-auto py-6 text-gray-400 text-xs">
        &copy; 2024 Daily Blessing App • Dikuasai oleh Gemini AI
    </footer>

    <script>
        // Data Ayat & Tantangan
        const data = [
            { verse: "Sebab Aku ini mengetahui rancangan-rancangan apa yang ada pada-Ku mengenai kamu, demikianlah firman TUHAN, yaitu rancangan damai sejahtera dan bukan rancangan kecelakaan, untuk memberikan kepadamu hari depan yang penuh harapan.", ref: "Yeremia 29:11", challenge: "Tuliskan 3 hal yang membuatmu optimis tentang masa depanmu hari ini." },
            { verse: "Segala perkara dapat kutanggung di dalam Dia yang memberi kekuatan kepadaku.", ref: "Filipi 4:13", challenge: "Lakukan satu tugas yang paling kamu hindari hari ini dengan semangat." },
            { verse: "Janganlah hendaknya kamu kuatir tentang apapun juga, tetapi nyatakanlah dalam segala hal keinginanmu kepada Allah dalam doa dan permohonan dengan ucapan syukur.", ref: "Filipi 4:6", challenge: "Berhenti mengeluh selama 3 jam ke depan. Setiap kali ingin mengeluh, gantilah dengan ucapan syukur." },
            { verse: "Kasih itu sabar; kasih itu murah hati; ia tidak cemburu. Ia tidak memegahkan diri dan tidak sombong.", ref: "1 Korintus 13:4", challenge: "Bersabarlah kepada seseorang yang biasanya membuatmu kesal hari ini." },
            { verse: "Serahkanlah segala kekuatiranmu kepada-Nya, sebab Ia yang memelihara kamu.", ref: "1 Petrus 5:7", challenge: "Luangkan waktu 5 menit untuk duduk diam dan menyerahkan beban pikiranmu dalam doa." },
            { verse: "Tetapi orang-orang yang menanti-nantikan TUHAN mendapat kekuatan baru: mereka seumpama rajawali yang naik terbang dengan kekuatan sayapnya.", ref: "Yesaya 40:31", challenge: "Berikan semangat kepada teman yang sedang merasa lelah atau putus asa." },
            { verse: "Bersukacitalah senantiasa dalam Tuhan! Sekali lagi kukatakan: Bersukacitalah!", ref: "Filipi 4:4", challenge: "Bagikan satu pesan lucu atau kabar baik kepada grup chat keluarga/temanmu." },
            { verse: "Berilah dan kamu akan diberi: suatu takaran yang baik, yang dipadatkan, yang digoncang dan yang tumpah ke luar akan dicurahkan ke dalam ribaanmu.", ref: "Lukas 6:38", challenge: "Traktir seseorang kopi atau makanan ringan tanpa alasan khusus." },
            { verse: "Percayalah kepada TUHAN dengan segenap hatimu, dan janganlah bersandar kepada pengertianmu sendiri.", ref: "Amsal 3:5", challenge: "Cobalah untuk tidak mengatur segala sesuatu hari ini, biarkan Tuhan yang menuntun langkahmu." },
            { verse: "Inilah perintah-Ku, yaitu supaya kamu saling mengasihi, sama seperti Aku telah mengasihi kamu.", ref: "Yohanes 15:12", challenge: "Kirimkan pesan apresiasi kepada orang tua atau saudaramu sekarang juga." }
        ];

        let currentRotation = 0;
        let isSpinning = false;
        let selectedData = null;
        const apiKey = ""; // Dikelola oleh lingkungan eksekusi

        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const resultModal = document.getElementById('resultModal');
        const aiResponseDiv = document.getElementById('aiResponse');
        const aiBtn = document.getElementById('aiBtn');
        const aiBtnText = document.getElementById('aiBtnText');

        // Fungsi Putar Roda
        function spinWheel() {
            if (isSpinning) return;

            isSpinning = true;
            aiResponseDiv.innerHTML = '<span class="text-gray-400 italic">Klik tombol di bawah untuk mendapatkan renungan...</span>';
            aiBtn.disabled = false;
            aiBtn.classList.remove('opacity-50', 'cursor-not-allowed');

            const randomDegree = Math.floor(Math.random() * 360) + 3600; // Minimal 10 putaran
            currentRotation += randomDegree;
            
            wheel.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                isSpinning = false;
                const actualDegree = currentRotation % 360;
                // Hitung index: 360 derajat / 10 segmen = 36 derajat per segmen
                // Karena putaran searah jarum jam tapi penunjuk di atas, kita perlu hitung offset
                let index = Math.floor((360 - (actualDegree % 360)) / 36);
                if (index === 10) index = 0;
                
                showResult(data[index]);
            }, 4000);
        }

        function showResult(item) {
            selectedData = item;
            document.getElementById('verseText').innerText = `"${item.verse}"`;
            document.getElementById('verseRef').innerText = item.ref;
            document.getElementById('challengeText').innerText = item.challenge;
            resultModal.style.display = 'flex';
        }

        function closeModal() {
            resultModal.style.display = 'none';
        }

        // Fungsi AI Gemini
        async function getAIGuidance() {
            if (!selectedData) return;

            aiBtn.disabled = true;
            aiBtnText.innerHTML = '<div class="loader"></div> Memikirkan Renungan...';
            aiResponseDiv.innerHTML = '<p class="text-purple-400 animate-pulse">Sedang menyusun kata-kata berkat untukmu...</p>';

            const prompt = `Berikan renungan singkat (maksimal 3 kalimat) dan satu kalimat doa pendek berdasarkan ayat Alkitab ini: "${selectedData.verse}" (${selectedData.ref}). Format jawaban: Renungan: [isi] Doa: [isi]. Gunakan nada yang hangat, penuh kasih, dan menguatkan.`;

            let retries = 0;
            const maxRetries = 5;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) throw new Error('API Error');

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        aiResponseDiv.innerHTML = text.replace(/\n/g, '<br>');
                        aiBtnText.innerText = 'Diberkati! (Tanya Lagi?)';
                        aiBtn.disabled = false;
                        return;
                    }
                } catch (error) {
                    retries++;
                    const delay = Math.pow(2, retries) * 500;
                    await new Promise(res => setTimeout(res, delay));
                }
            }

            aiResponseDiv.innerHTML = '<span class="text-red-400 text-xs">Maaf, koneksi ke surga digital sedang sibuk. Silakan coba lagi nanti.</span>';
            aiBtnText.innerText = 'Coba Lagi';
            aiBtn.disabled = false;
        }

        // Event Listeners
        spinBtn.addEventListener('click', spinWheel);
        aiBtn.addEventListener('click', getAIGuidance);

        // Close on background click
        window.onclick = function(event) {
            if (event.target == resultModal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
